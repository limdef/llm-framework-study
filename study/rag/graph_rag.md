# GraphRAG

### 이해

1. 기존 벡터 RAG 한계  
벡터 유사도로 가져오는 문서가 서로 파편화되어 있을 가능성이 있음   
-> 문서 간의 연결 관계와 정보가 빈약할 수 있음  

2. GraphRAG 아이디어  
문서를 개념 기반으로 요약해서 정보 간 관계를 그래프로 표현하고 탐색하자.

3. Triplet 구조  
문서에서 개념1 - 관계 - 개념2 의 형태를 추출함 (LLM 사용)  
ex. (튜링 테스트 - 평가 기준 - 인공지능), (앨런 튜링 - 제안 - 튜링 테스트)  


4. 그래프 구축  
위 triplet 기반으로 노드가 개념, 엣지가 관계가 되는 그래프 DB를 구성.  

5. 질의 응답  
* 사용자의 질문을 개념화하여 그래프에서 노드 주변을 탐색.  
* 탐색된 정보들을 모두 가져와서 LLM 에게 문맥으로 제공하면서 질의 응답.  



### 탐색 방식

1. DFS - 보통 n단계 까지만  
장점 - 너무 넓게 퍼지지 않고 문맥 유지  
단점 - 유용한 노드가 더 깊이 있을 수 있음  

2. BFS - 넓게 퍼지는 방식  
3. Personalized PageRank (추천 기반 순위화)  

* PageRank는 Google이 웹페이지 순위 매길 때 만든 알고리즘  
* 핵심 아이디어는 “많은 중요한 노드로부터 연결된 노드는 중요하다." 
    * 연결된 노드가 많다 = 중요도 ↑, 연결된 노드가 적다 = 중요도 ↓, 중요한 노드와 연결되어 있다 = 중요도 ↑.  
    * 많은 노드가 나를 가리킬수록 (인기 많음), 중요한 노드가 나를 가리킬수록 높은 점수를 매겨서 그래프 전체에 점수 계산을 돌리고 중요도 부여 
    * 즉 연결된 노드가 많으면 당연히 중요도가 높고, 연결된 노드가 적더라도 중요한 노드와 연결되어 있으면 (질이 좋음) 중요도가 높음.  


4. Semantic Filtering + Graph Search  
5. Subgraph Induction (부분 그래프 유도)  
특정 주제에 관련된 부분 그래프 전체를 뽑아서 문맥으로 구성  


### 라이브러리  

| 라이브러리|	사용 탐색 방식|
| --- | --- | 
|Neo4j	|Cypher 쿼리로 깊이 제한 탐색 (DFS), PageRank|
|NetworkX	|BFS, DFS, Personalized PageRank|
|LlamaIndex + GraphRAG|	그래프 + 벡터 유사도 혼합 탐색 방식 자주 사용|


* GraphRAG 역시 llamaindex를 사용해서 연동 가능  
-> LlamaIndex는 Neo4j와 직접 연동 가능한 Neo4jGraph라는 모듈을 제공  



### 관계 표준화  

문서에서 추출된 관계는 사람들이 표현하는 방식이 다양해서 같은 의미도 다르게 표현되는 문제가 있다.  

사전 매핑을 하거나 LLM을 사용해서 ("이 관계를 표준화 해줘") 관계를 표준화 한다.

** 관계 사전을 계속해서 가지고 있으면서 비슷한 관계이면 매핑 없으면 추가하는 식도 괜찮을 듯.  
